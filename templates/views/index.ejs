<!DOCTYPE hmtl>

<html>

  

<head>

        <!-- ZingChart CDN script -->
        
    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>

        <style>
        #chart {
            height:300px;
            width: 300px;
        }
    </style>
    <link rel="stylesheet" href="./css/style.css">

      
</head>

  

<body>
    
     

    
    <% let count = 0; %>
        <!-- EJS loop through employees returned from MongoDB -->
    <!--     <ul>

              
              <% employees.forEach(employee=> { %>
                  <li>
                <%= `Age: ${employee.age}, Name: ${employee.name}` %>

            </li>
            <% count++ %>
                  <% }); %>

                    </ul> -->

             

        <!-- chart container -->
    <div class="alert"> <h1>
        <%=` ${message}` %>
    </h1> 
</div>
       
<div class = "container">
    
        <h1>Dehaat Employees</h1>
        <form id="form" action="/add/form" method="POST">
            <div class="input-group">
            <!-- <label for="name">Name</label> -->
             <input type="text" name="name" placeholder="Enter a name" id="">
            </div>
            <div class = "input-group">
             <input type="number" name="age" placeholder="Age" id="">
            </div>
            
             <input class="submit-btn" type="submit" value="Register"name="" id="">
        </form>
           <form id="form" action="/csvform" method="POST" enctype='multipart/form-data'>
             <div class="input-group-files">
                <label for='file'>Select files</label>
                <input id='file' type="file"  name="file">
            </div>
            <input class="submit-btn" type="submit" value="Upload CSV"name="" id="">
            </form>
            <a href="/form"><button class="submit-btn" type="button" >Download CSV</button></a>

            <div id="chart"></div>
            <h2>
                <%=`Total: ${count}` %>
                
               </h2> 
    </div>
    

        <!-- fetches data from api/data page & renders chart from data returned -->
   
    <script>

        // creates variable for url we want to fetch
        const url = '/api/data';

        // fetch call to our /api/data page
        fetch(url)

            // creates promise to work with response from /api/data
            .then(res => {

                // throws error if there is a problem fetching page
                if (!res.ok) {

                    // returns error with response text of error
                    throw new Error(res.statusText);

                }

                // returns data from /api/data page in json format to next promise
                return res.json();

            })

            // creates promise with returned data from previous promise
            .then(data => {

                // creates employees variable to store JSON data form /api/data
                let employees = data;

                // creates empty employeeInfo array
                let employeeInfo = [];

                // loops through data from employee variable
                employees.forEach(employee => {

                    // pushes values from employees variable to empty employeeInfo array
                    employeeInfo.push([employee.Name, parseInt(employee.Age)]);

                });

                // creates chart const with employeeInfo array
                const chart = {
                    type: 'bar',
                    series: [
                        {
                            values: employeeInfo
                        }
                    ]
                };

                // renders zingchart to the page
                zingchart.render({
                    id: 'chart',
                    data: chart,
                    height: '100%',
                    width: '100%'
                });

            })

            // catches errors in promise chain
            .catch(error => console.log('fetch error'));

    </script>
    


      
</body>

</html>